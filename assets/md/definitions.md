### ３つの重要な指標
1. 支持度（Support）
<br>
<br>
1. 確信度（Confidence）
<br>
<br>
1. リフト（Lift）

Note: この章では、パターンを評価するために重要な３つの指標について説明していきます。後で一つずつ細かく見ていきますが、簡単に説明すると、一つ目は、支持度あるいはサポートと呼ばれるもので、パターンがどのくらいの割合で出現するかを表します。二つ目は、確信度あるいはコンフィデンスと呼ばれるもので、ある商品が出現した時に、別の商品が出現する割合を表します。三つ目は、リフトと呼ばれるもので、ある商品が出現した時に、別の商品が出現する割合が、その別の商品が単独で出現する割合に対して何倍になっているかを表します。詳しく説明する前に、一旦、基本的な言葉や記号の定義をしていきます。
---

### 基本的な定義（１）
- $ トランザクション: \begin{align} \quad & 個々の客の1回の買い物 \\\ & （バスケット） \end{align} $ |
<br>
<br>
- $ \Omega: \quad 全トランザクション $ |
<br>
<br>
- $ A: \quad 商品Aの購入を含むトランザクション $ |
<br>
<br>
- $ A \cap B: 商品Aと商品Bの両方の購入を含むトランザクション $ |

Note: 個々の客の一回の買い物のことをトランザクションと言います。そして、これはギリシャ文字でオメガと読むんですが、オメガという記号で、全トランザクションの集合を表すことにします。また、商品Aの購入を含むトランザクションの集合を、単にAと表すことにします。商品Aが入っているバスケットの集合と考えて頂いて構いません。さらに、アルファベットのユーを上下ひっくり返したような記号が入っていますが、エーカツビーという記号で、商品Aと商品Bの両方の購入を含むトランザクションの集合を表します。商品Aと商品Bの両方が入っているバスケットの集合と考えて頂いて構いません。
---

### 基本的な定義（２）
- $ n( \Omega ): \quad トランザクションの総数（バスケットの総数） $ |
<br>
<br>
- $ n(A): \begin{align} \quad & 商品Aの購入を含むトランザクションの総数 \\\ & （商品Aを含むバスケットの総数）\end{align} $ |
<br>
<br>
- $ n \bigl( A \cap B \bigr) : \begin{align} \quad & 商品Aと商品Bの両方の購入を含む \\\ & トランザクションの総数 \\\ & （商品Aと商品Bの両方を含むバスケットの総数）\end{align} $ |

Note: 次に、トランザクションの数について考えます。エヌオメガという記号で、トランザクションの総数を表します。エヌエーという記号で、商品Aの購入を含むトランザクションの総数を表します。エヌエーカツビーという記号で、商品Aと商品Bの両方の購入を含むトランザクションの総数を表します。
---

### 基本的な定義（３）
- $ \begin{align} 商品Aが購入される確率: \\\ \qquad P(A) \equiv \frac{n(A)}{n( \Omega )} \end{align} $ |
<br>
<br>
- $ \begin{align} 商品Aと商品Bが同時購入される確率: \\\ \qquad P \bigl( A \cap B \bigr) \equiv \frac{n \bigl( A \cap B \bigr) }{n( \Omega )} \end{align} $ |

Note: 次は確率についての定義です。商品Aが購入される確率、これをピーエーと書きます。そして、三本線のイコールがありますが、これは定義する、という意味の記号です。ピーエーを、エヌオメガ分のエヌエー、つまり、全トランザクションに対する、商品Aを購入しているトランザクションの割合で定義します。同様に、商品Aと商品Bが同時購入される確率ピーエーカツビーを、エヌオメガ分のエヌエーカツビーで定義します。
---

### 基本的な定義（４）
$ \begin{align} 商品Bを購入しているという条件での、 \\\ 商品Aを購入している条件付き確率 \end{align}: $
<br>
$$ \begin{align} P \bigl( A \; | \; B \bigr) & \equiv \frac{n \bigl( A \cap B \bigr)}{n(B)} \\\ & = \frac{P \bigl( A \cap B \bigr) }{P(B)} \end{align} $$

Note: 今度は条件付き確率です。商品Bを購入しているという条件での、商品Aを購入している条件付き確率ピーエーパイプビーを、エヌビー分のエヌエーカツビーで定義します。分母と分子をエヌオメガで割ると、これは、ピービー分のピーエーカツビーと一致することがわかります。ピーエーパイプビーの右側のビーが条件部であることに注意して下さい。それをはっきりさせるために、ピーエーギブンビーという読み方をすることもあります。
---

### 基本的な定義（５）
$ A \Rightarrow B: $
<br>
<br>
$$ 「商品Aを購入していると商品Bも購入している」 \\\ というルール（左側を条件部、右側を結論部と呼ぶ） $$
<br>
※この講座では、条件部は単一商品とする

Note: 次に、右向きの矢印が出てきますが、エーナラバビーという記号で、商品Aを購入していると商品Bも購入しているというルールを表します。左側を条件部、右側を結論部と呼びます。実際には、条件部は複数の商品でも構いません。つまり、商品Aと商品Bを購入していると、商品Cも購入している、というルールを考えることができます。しかし、この講座では、概念の本質を理解しやすいように、単純化して、条件部が単一商品の場合に限定して説明していきます。
---

### 支持度（１）
$ 商品Aの支持度: $
$$ \begin{align} Supp(A) & \equiv \frac{n(A)}{n(\Omega)} \\\ & = P(A) \end{align} $$

Note: それでは、重要な指標の一つ目、支持度について説明していきます。商品Aの支持度、サポートエーと書きますが、これを、エヌオメガ分のエヌエーで定義します。これは基本的な定義で確認したように、商品Aが購入される確率のことです。
---

### 支持度（２）
$ ルール A \Rightarrow B の支持度: $
$$ \begin{align} Supp \bigl( A \Rightarrow B \bigr) & \equiv \frac{n \bigl( A \cap B \bigr) }{n( \Omega )} \\\ & = P \bigl( A \cap B \bigr) = P \bigl( B \cap A \bigr) \\\ & = \frac{n \bigl( B \cap A \bigr) }{n( \Omega )} \\\ & = Supp \bigl( B \Rightarrow A \bigr) \end{align} $$

Note: さっきは商品の支持度だったのですが、今度はルールの支持度です。ルールエーナラバビーの支持度、サポートエーナラバビーと書きますが、これを、エヌオメガ分のエヌエーカツビーで定義します。商品Aと商品Bが併売される確率のことです。式を変形しても分かりますが、商品Aと商品Bが同時購入される確率なので、AとBを入れ替えても同じです。つまり、ルールエーナラバビーの支持度と、ルールビーナラバエーの支持度は同じです。矢印が付いていますが、支持度に関しては方向性がないので注意して下さい。
---

### 支持度の補足
- $ Supp \bigl( A \Rightarrow B \bigr) $ は全トランザクションに対して、商品 $ A $ と商品 $ B $ が併売されているトランザクションの割合 |
- $ Supp \bigl( A \Rightarrow B \bigr) = Supp \bigl( B \Rightarrow A \bigr) $ |
- 支持度が小さいルールを除外することで、ほとんど売れていな商品 $ A $ と $ B $ が偶然同時に買われた場合に、そのルールを重要視してしまうことを防ぐ |
- 支持度が小さいルールを除外することで、ルールとして意味があったとしてもビジネスとしての旨味は少ないものを除外する |

Note: 支持度の補足です。もう一度確認すると、ルールエーナラバビーの支持度は、全トランザクションに対して、商品Aと商品Bが併売されているトランザクションの割合です。つまり、商品Aと商品Bが併売される確率のことです。ルールエーナラバビーの支持度と、ルールビーナラバエーの支持度は同じです。実際にアソシエーションをする際には、支持度が小さいルールを除外しますが、そうすることで、ほとんど売れていない商品Aと商品Bが偶然同時に買われた場合に、そのルールを重要視してしまうことを防ぎます。そうしないと、たまたま同時に買われただけなのに、商品Aを買うと、ほとんど確実に商品Bも買うということになってしまいます。また、支持度が小さいルールを除外することで、ルールとして意味があったとしても、ビジネスとしての旨味は小さいものを除外します。ただし、ニッチだけど確実性の高いルールを見つけたい、というような場合は、支持度が小さいものでも見ていく必要があります。
---

### 確信度
$ ルール A \Rightarrow B の確信度: $
$$ \begin{align} Conf \bigl( A \Rightarrow B \bigr) & \equiv \frac{Supp \bigl( A \Rightarrow B \bigr) }{Supp(A)} \\\ & = \frac{P \bigl( A \cap B \bigr) }{P(A)} \\\ & = P \bigl( B \; | \; A \bigr) \end{align} $$

Note: それでは、重要な指標の二つ目、確信度について説明していきます。ルールエーナラバビーの確信度、コンフィデンスエーナラバビーと書きますが、これをサポートエー分のサポートエーカツビーで定義します。商品Aが購入されているトランザクションのうち、商品Bも購入されているトランザクションの割合です。式を変形すると、条件付き確率ピービーパイプエーと一致することがわかります。
---

### 確信度の補足
- $ Conf \bigl( A \Rightarrow B \bigr) $ は、商品 $ A $ が購入されているトランザクションに対して、商品 $ B $ も購入されている（商品 $ A $ と商品 $ B $ が併売されている）トランザクションの割合 |
- $ Conf \bigl( A \Rightarrow B \bigr) \neq Conf \bigl( B \Rightarrow A \bigr) $ |
- $ Conf \bigl( A \Rightarrow B \bigr) $ が大きいほど、 商品 $ A $ と商品 $ B $ は関連が強いと言える（ただし上の項目に注意） |
- 確信度の高いルールを抽出するが、リフトも見ることが重要 |

Note: 確信度の補足です。もう一度確認すると、ルールエーナラバビーの確信度は、商品Aが購入されているトランザクションに対して、商品Bも購入されているトランザクションの割合です。つまり、商品Aを購入しているという条件での、商品Bを購入する条件付き確率のことです。支持度の場合と違って、ルールエーナラバビーの確信度と、ルールビーナラバエーの確信度は一致しません。偶然一致することは有り得るんですが、基本的には異なります。ルールエーナラバビーの確信度が大きいほど、商品Aと商品Bは関連が強いと言えます。ただし、上に書いたように方向性があるので注意して下さい。そして、次がポイントです。確信度の高いルールを抽出するのですが、リフトも見ることが重要です。なぜなら、商品の関連性によらずに、たくさん売れている商品があった場合、その商品を結論部とするルールの確信度が高くなりやすいからです。
本当に意味のあるパターンを見つけるには、商品の関連性によらずに単独で売れている効果を割り引いて考える必要があります。そのための指標が、次に説明するリフトです。
---

### リフト
$ ルール A \Rightarrow B のリフト: $
$$ \begin{align} Lift \bigl( A \Rightarrow B \bigr) & \equiv \frac{Conf \bigl( A \Rightarrow B \bigr) }{Supp(B)} \\\ & = \frac{P \bigl( B \; | \; A \bigr) }{P(B)} \\\ & = \frac{P \bigl( A \cap B \bigr)}{P(A)P(B)} = Lift \bigl( B \Rightarrow B \bigr) \end{align} $$

Note: ルールエーナラバビーのリフト、リフトエーナラバビーと書きますが、これを、サポートビー分のコンフィデンスエーナラバビーで定義します。商品ビーが単独で売れている割合に対して、ルールエーナラバビーの確信度が何倍か、ということです。式を変形すると、AとBを入れ替えても同じ、つまり、ルールエーナラバビーのリフトと、ルールビーナラバエーのリフトは一致することが分かります。
---

### リフトの補足
- 単純に商品 $ B $ を購入する割合よりも、商品 $ A $ を購入した中で商品 $ B $ も購入した割合の方が高いとき、 $ Lift \bigl( A \Rightarrow B \bigr) $ は1を超える |
- リフトが1を超えるルールが意味のあるルール |
- $ Lift \bigl( A \Rightarrow B \bigr) = Lift \bigl( B \Rightarrow A \bigr) $ |
- リフトが大きいルールを抽出することで、商品の関連性によらず売れている商品を除外することができる |

Note: リフトの補足です。単純に商品Bを購入する割合よりも、商品Aを購入した中で商品Bも購入した割合の方が高い時、ルールエーナラバビーのリフトは１を超えます。したがって、リフトが１を超えるルールが意味のあるルールです。ルールエーナラバビーのリフトと、ルールビーナラバエーのリフトは一致します。最後に、リフトが大きいルールを抽出することで、商品の関連性によらず売れている商品を除外することができます。
